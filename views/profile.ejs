<!DOCTYPE html>
<html lang="ru">
<head>
    <%- include('./partials/head') %>
    
    <link rel="stylesheet" href="/libs/micromodal/micromodal.css">
    <link rel="stylesheet" href="/styles/main-page-styles.css">
    <link rel="stylesheet" href="/styles/profile-page-styles.css">
    <title>Личный кабинет</title>
</head>
<body>
    <div class="wrapper">  
        <%- include('./partials/header') %>

        <main class="main">
            <div class="main_inner">
                <section class="profile-section">
                    <div class="avatar-block content-block">
                        <svg class="avatar-block-profile-icon" viewBox="0 0 395 395" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="197.5" cy="197.5" r="190.5" stroke="#F9F9F9" stroke-width="14"/>
                            <path d="M197.5 199.482C184.27 199.482 173.445 195.372 165.026 187.152C156.607 178.932 152.398 168.363 152.398 155.446C152.398 142.529 156.607 131.96 165.026 123.74C173.445 115.52 184.27 111.41 197.5 111.41C210.73 111.41 221.554 115.52 229.973 123.74C238.392 131.96 242.602 142.529 242.602 155.446C242.602 168.363 238.392 178.932 229.973 187.152C221.554 195.372 210.73 199.482 197.5 199.482ZM101.282 293.718V266.122C101.282 258.685 103.186 252.324 106.995 247.04C110.803 241.756 115.714 237.744 121.728 235.004C135.158 229.132 148.038 224.729 160.366 221.793C172.694 218.857 185.072 217.389 197.5 217.389C209.928 217.389 222.256 218.906 234.483 221.94C246.711 224.973 259.54 229.328 272.971 235.004C279.185 237.744 284.196 241.756 288.005 247.04C291.813 252.324 293.718 258.685 293.718 266.122V293.718H101.282ZM119.323 276.104H275.677V266.122C275.677 262.991 274.725 260.006 272.82 257.168C270.916 254.331 268.561 252.227 265.754 250.857C252.925 244.789 241.199 240.631 230.575 238.38C219.951 236.129 208.926 235.004 197.5 235.004C186.074 235.004 174.949 236.129 164.124 238.38C153.3 240.631 141.573 244.789 128.944 250.857C126.138 252.227 123.833 254.331 122.029 257.168C120.225 260.006 119.323 262.991 119.323 266.122V276.104ZM197.5 181.867C205.317 181.867 211.782 179.372 216.894 174.381C222.005 169.391 224.561 163.079 224.561 155.446C224.561 147.813 222.005 141.501 216.894 136.511C211.782 131.52 205.317 129.025 197.5 129.025C189.682 129.025 183.217 131.52 178.106 136.511C172.994 141.501 170.438 147.813 170.438 155.446C170.438 163.079 172.994 169.391 178.106 174.381C183.217 179.372 189.682 181.867 197.5 181.867Z" fill="#F9F9F9"/>
                        </svg>  
                    </div>
                    <div class="personal-info-block content-block">
                        <div class="personal-info-block-body">
                            <div class="personal-info-block-body-header">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17.9334 21.2571C17.7171 20.0575 16.9849 18.9644 15.8732 18.1813C14.7615 17.3983 13.346 16.9787 11.8906 17.0008C10.4352 17.0229 9.0391 17.4852 7.96236 18.3015C6.88562 19.1178 6.20171 20.2325 6.03804 21.4378" stroke="rgb(249,249,249)" stroke-width="1.5"/>
                                    <circle cx="12" cy="10" r="3" stroke="rgb(249,249,249)" stroke-width="1.5" stroke-linecap="round"/>
                                    <rect x="2.75" y="2.75" width="18.5" height="18.5" rx="3.25" stroke="rgb(249,249,249)" stroke-width="1.5"/>
                                </svg>                                                                   
                                ЛИЧНАЯ ИНФОРМАЦИЯ
                            </div>
                            <hr class="h-line">
                            <table class="user-data-table">
                                <tr class="user-data-table-row">
                                    <th class="user-data-table-row-field">Имя:</th>
                                    <td class="user-data-table-row-value"><%= user.name %></td>
                                </tr>
                                <tr class="user-data-table-row">
                                    <th class="user-data-table-row-field">Фамилия:</th>
                                    <td class="user-data-table-row-value"><%= user.surname %></td>
                                </tr>
                                <tr class="user-data-table-row">
                                    <th class="user-data-table-row-field">Отчество:</th>
                                    <td class="user-data-table-row-value"><%= user.middle_name %></td>
                                </tr>
                                <tr class="user-data-table-row">
                                    <th class="user-data-table-row-field">Почта:</th>
                                    <td class="user-data-table-row-value"><%= user.email %></td>
                                </tr>
                                <tr class="user-data-table-row">
                                    <th class="user-data-table-row-field">Статус:</th>
                                    <% switch(user.role) {
                                        case 'Обучающийся': %>
                                            <td class="user-data-table-row-value css-student-user-status"><%= user.role %></td>
                                        <% break;
                                        case 'Преподаватель': %>
                                            <td class="user-data-table-row-value css-teacher-user-status"><%= user.role %></td>
                                        <% break;
                                        case 'Администратор': %>
                                            <td class="user-data-table-row-value css-admin-user-status"><%= user.role %></td>
                                        <% break;
                                    } %>
                                </tr>
                            </table>
                        </div>
                        <div class="personal-info-block-btns">
                            <button class="edit-profile-button" data-custom-open="editDataModal">
                                <div class="edit-profile-button-icon">
                                    <img src="/assets/icons/settings-icon.svg" alt="Log-out-icon" class="edit-profile-button-icon-icon">
                                </div>
                                Изменить
                            </button>
                            <a href="/profile/log-out" class="log-out-button">
                                <div class="log-out-button-icon">
                                    <svg  class="log-out-button-icon-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M14 7.63636L14 4.5C14 4.22386 13.7761 4 13.5 4L4.5 4C4.22386 4 4 4.22386 4 4.5L4 19.5C4 19.7761 4.22386 20 4.5 20L13.5 20C13.7761 20 14 19.7761 14 19.5L14 16.3636" stroke="rgb(228,228,228)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M10 12L21 12M21 12L18.0004 8.5M21 12L18 15.5" stroke="rgb(228,228,228)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </div>
                                Выйти
                            </a>
                        </div>
                    </div>
                    <% switch(user.role) {
                        case 'Обучающийся': %>
                            <div class="statistic-block content-block">
                                <div class="statistic-block-header">
                                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M5.30676 16.3821C5.64514 16.899 6.04391 17.3775 6.4968 17.8067C7.61899 18.8703 9.02535 19.586 10.5458 19.8671C12.0662 20.1482 13.6354 19.9826 15.0637 19.3905C16.492 18.7984 17.7181 17.8051 18.5937 16.5308C19.4693 15.2564 19.9569 13.7557 19.9974 12.21C20.0379 10.6644 19.6296 9.14014 18.822 7.82167C18.0144 6.5032 16.842 5.44701 15.4467 4.78089C14.5024 4.33008 13.4834 4.07101 12.4481 4.01294L13.0032 6.08484C13.5483 6.17728 14.0809 6.34509 14.585 6.58577C15.6315 7.08536 16.5108 7.8775 17.1165 8.86635C17.7223 9.8552 18.0284 10.9984 17.9981 12.1576C17.9677 13.3168 17.602 14.4424 16.9453 15.3982C16.2886 16.3539 15.369 17.0989 14.2978 17.543C13.2266 17.9871 12.0496 18.1112 10.9093 17.9004C9.76905 17.6896 8.71427 17.1529 7.87263 16.3551C7.69689 16.1886 7.53201 16.0121 7.37866 15.8269L5.30676 16.3821Z" fill="rgb(249,249,249)"/>
                                        <path d="M5.91239 4.06647C6.68924 3.47037 7.54796 2.99272 8.46042 2.64739C8.87978 2.48868 9.08946 2.40932 9.28694 2.51053C9.48442 2.61174 9.54649 2.84338 9.67063 3.30667L11.7412 11.0341C11.8632 11.4894 11.9242 11.7171 11.8206 11.8964C11.7171 12.0758 11.4894 12.1368 11.0341 12.2588L3.30667 14.3294C2.84338 14.4535 2.61174 14.5156 2.42535 14.3952C2.23896 14.2747 2.20284 14.0535 2.13061 13.6109C1.97344 12.6481 1.95774 11.6656 2.08555 10.6947C2.25696 9.39275 2.68314 8.13728 3.33975 7C3.99636 5.86272 4.87054 4.8659 5.91239 4.06647Z" stroke="rgb(249,249,249)" stroke-width="2"/>
                                    </svg>
                                    Статистика обучения
                                </div>
                                <hr class="h-line">
                                <% if (userStatistic.length) { %>
                                <div class="filter-buttons">
                                    <button class="filter-button">5</button>
                                    <button class="filter-button">4</button>
                                    <button class="filter-button">3</button>
                                    <button class="filter-button">2</button>
                                    <button class="filter-button">1</button>
                                    <button class="filter-button active">Все</button>
                                </div>
                                <ul class="statistic-list">
                                    <% userStatistic.forEach((stat) => { %>
                                        <li class="statistic-item">
                                            <div class="statistic-item-header">
                                                <div class="statistic-item-info">
                                                    <div class="item-info-theme-title"><%= stat.themeTitle %></div>
                                                    <div class="item-info-note"><%= stat.note %></div>
                                                </div>
                                                <div class="statistic-item-score score_<%= stat.score %>">
                                                    <%= stat.score %>
                                                </div>
                                            </div>
                                            <div class="statistic-item-details">
                                                <div class="deatils-teacher-info">
                                                    <svg viewBox="0 0 24 24" fill="none">
                                                        <circle cx="12" cy="7" r="4" stroke="#E4E4E4" stroke-width="2" stroke-linecap="round"/>
                                                        <path d="M5.33788 18.3206C5.99897 15.5269 8.77173 14 11.6426 14H12.3574C15.2283 14 18.001 15.5269 18.6621 18.3206C18.79 18.8611 18.8917 19.4268 18.9489 20.0016C19.0036 20.5512 18.5523 21 18 21H6C5.44772 21 4.99642 20.5512 5.0511 20.0016C5.1083 19.4268 5.20997 18.8611 5.33788 18.3206Z" stroke="#E4E4E4" stroke-width="2" stroke-linecap="round"/>
                                                    </svg>                                                            
                                                    <%= stat.authorSurname + ' ' + stat.authorName.charAt(0)  + '. ' + stat.authorMidName.charAt(0) + '.' %>
                                                </div>
                                                <div class="deatils-date">
                                                    <svg viewBox="0 0 24 24" style="fill: rgba(228, 228, 228, 1)"><path d="M7 11h2v2H7zm0 4h2v2H7zm4-4h2v2h-2zm0 4h2v2h-2zm4-4h2v2h-2zm0 4h2v2h-2z"></path><path d="M5 22h14c1.103 0 2-.897 2-2V6c0-1.103-.897-2-2-2h-2V2h-2v2H9V2H7v2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2zM19 8l.001 12H5V8h14z"></path></svg>                                                          
                                                    <%= stat.date.toLocaleString("ru", {
                                                        year: 'numeric',
                                                        month: 'numeric',
                                                        day: 'numeric',
                                                    }) %>
                                                </div>
                                            </div>
                                        </li>
                                    <% })%>
                                </ul>
                                <%} else { %>
                                    <div class="statistic-empty-item">
                                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <circle cx="12" cy="12" r="10" stroke="#DD9000" stroke-width="1.5" stroke-linecap="round"/>
                                            <path d="M7.88124 16.2441C8.37391 15.8174 9.02309 15.5091 9.72265 15.3072C10.4301 15.103 11.2142 15 12 15C12.7858 15 13.5699 15.103 14.2774 15.3072C14.9769 15.5091 15.6261 15.8174 16.1188 16.2441" stroke="#DD9000" stroke-width="1.5" stroke-linecap="round"/>
                                            <circle cx="9" cy="10" r="1.25" fill="#DD9000" stroke="#DD9000" stroke-width="0.2" stroke-linecap="round"/>
                                            <circle cx="15" cy="10" r="1.25" fill="#DD9000" stroke="#DD9000" stroke-width="0.2" stroke-linecap="round"/>
                                        </svg>                                                                                    
                                        У вас пока нет статистики
                                    </div>
                                <% } %>
                            </div>  
                        <% break;
                        case 'Преподаватель': %>
                        <% break;
                        case 'Администратор': %>
                        <% break;
                    } %>
                </section>
            </div>
            <div class="modal micromodal-slide" id="editDataModal">
                <div class="modal__overlay">
                  <div class="modal__container" role="dialog">
                    <div class="modal__header">
                        <h2 class="modal__title d-inline-flex align-items-center gap-1">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M17.9334 21.2571C17.7171 20.0575 16.9849 18.9644 15.8732 18.1813C14.7615 17.3983 13.346 16.9787 11.8906 17.0008C10.4352 17.0229 9.0391 17.4852 7.96236 18.3015C6.88562 19.1178 6.20171 20.2325 6.03804 21.4378" stroke="rgb(249,249,249)" stroke-width="1.5"/>
                                <circle cx="12" cy="10" r="3" stroke="rgb(249,249,249)" stroke-width="1.5" stroke-linecap="round"/>
                                <rect x="2.75" y="2.75" width="18.5" height="18.5" rx="3.25" stroke="rgb(249,249,249)" stroke-width="1.5"/>
                            </svg>  
                            Личная информация
                        </h2>
                        <svg class="modal__close" data-custom-close="editDataModal" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 21C10.8181 21 9.64778 20.7672 8.55585 20.3149C7.46392 19.8626 6.47177 19.1997 5.63604 18.364C4.80031 17.5282 4.13738 16.5361 3.68508 15.4442C3.23279 14.3522 3 13.1819 3 12C3 10.8181 3.23279 9.64778 3.68508 8.55585C4.13738 7.46392 4.80031 6.47177 5.63604 5.63604C6.47177 4.80031 7.46392 4.13738 8.55585 3.68508C9.64778 3.23279 10.8181 3 12 3C13.1819 3 14.3522 3.23279 15.4442 3.68508C16.5361 4.13738 17.5282 4.80031 18.364 5.63604C19.1997 6.47177 19.8626 7.46392 20.3149 8.55585C20.7672 9.64778 21 10.8181 21 12C21 13.1819 20.7672 14.3522 20.3149 15.4442C19.8626 16.5361 19.1997 17.5282 18.364 18.364C17.5282 19.1997 16.5361 19.8626 15.4441 20.3149C14.3522 20.7672 13.1819 21 12 21L12 21Z" stroke="rgb(228,228,228)" stroke-width="1.5" stroke-linecap="round"/>
                            <path d="M9 9L15 15" stroke="rgb(228,228,228)" stroke-width="1.5" stroke-linecap="round"/>
                            <path d="M15 9L9 15" stroke="rgb(228,228,228)" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>                         
                    </div>
                    <div class="modal__content">
                        <form method="POST" action="/profile/update-user-data" id="editDataModal-form">
                            <div class="mb-3 edit-form-item">
                                <label for="name">Имя</label>
                                <input type="text" value="<%= user.name %>" name="name" id="name">
                            </div>
                            <div class="mb-3 edit-form-item">
                                <label for="name">Фамилия</label>
                                <input type="text" value="<%= user.surname %>" name="surname" id="surname">
                            </div>
                            <div class="mb-3 edit-form-item">
                                <label for="name">Отчество</label>
                                <input type="text" value="<%= user.middle_name %>" name="middle_name" id="middle_name">
                            </div>
                            <div class="mb-3 edit-form-item">
                                <label for="name">Почта</label>
                                <input type="text" value="<%= user.email %>" name="email" id="email">
                            </div>
                            <div class="edit-form-action">
                                <input type="hidden" value="<%= user.user_id %>" name="user_id">
                                <input type="submit" value="Сохранить">
                            </div>
                        </form>
                    </div>
                  </div>
                </div>
            </div>
        </main>
        
        <%- include('./partials/footer') %>
    </div>
    <script src="/libs/micromodal/micromodal.min.js"></script>
    <script src="/scripts/profile-page-script.js"></script>
</body>
</html>